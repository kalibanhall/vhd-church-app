// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modèle principal pour les utilisateurs/membres de l'église
model User {
  id                      String    @id @default(cuid())
  firstName               String    @map("first_name") @db.VarChar(100)
  lastName                String    @map("last_name") @db.VarChar(100)
  email                   String    @unique @db.VarChar(255)
  phone                   String?   @db.VarChar(20)
  passwordHash            String    @map("password_hash") @db.VarChar(255)
  role                    Role      @default(MEMBER)
  status                  Status    @default(ACTIVE)
  birthDate               DateTime? @map("birth_date") @db.Date
  address                 String?   @db.Text
  profileImageUrl         String?   @map("profile_image_url") @db.VarChar(500)
  membershipDate          DateTime  @map("membership_date") @db.Date
  membershipNumber        String?   @unique @map("membership_number") @db.VarChar(50)
  emergencyContactName    String?   @map("emergency_contact_name") @db.VarChar(100)
  emergencyContactPhone   String?   @map("emergency_contact_phone") @db.VarChar(20)
  baptismDate             DateTime? @map("baptism_date") @db.Date
  maritalStatus           MaritalStatus? @map("marital_status")
  profession              String?   @db.VarChar(100)
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")

  // Relations
  donations               Donation[]
  createdEvents           Event[]          @relation("EventCreator")
  eventAttendances        EventAttendance[]
  sermons                 Sermon[]
  appointments            Appointment[]    @relation("UserAppointments")
  pastorAppointments      Appointment[]    @relation("PastorAppointments")
  prayers                 Prayer[]
  prayerSupports          PrayerSupport[]
  testimonies             Testimony[]
  messages                Message[]
  notifications           Notification[]
  faceRecognitionData     FaceRecognitionData[]
  channelMemberships      ChannelMember[]
  messageReactions        MessageReaction[]

  @@map("users")
}

// Enums pour les rôles et statuts
enum Role {
  MEMBER
  DEACON
  PASTOR
  ADMIN
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

// Modèle pour les dons
model Donation {
  id               String           @id @default(cuid())
  userId           String           @map("user_id")
  amount           Decimal          @db.Decimal(10, 2)
  donationType     DonationType     @map("donation_type")
  paymentMethod    PaymentMethod    @map("payment_method")
  paymentReference String?          @map("payment_reference") @db.VarChar(100)
  donationDate     DateTime         @map("donation_date") @db.Date
  status           DonationStatus   @default(COMPLETED)
  projectId        String?          @map("project_id")
  notes            String?          @db.Text
  receiptNumber    String?          @unique @map("receipt_number") @db.VarChar(50)
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")

  // Relations
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  project          DonationProject? @relation(fields: [projectId], references: [id])

  @@map("donations")
}

// Modèle pour les projets de donation
model DonationProject {
  id              String              @id @default(cuid())
  projectName     String              @map("project_name") @db.VarChar(200)
  description     String?             @db.Text
  targetAmount    Decimal             @map("target_amount") @db.Decimal(15, 2)
  currentAmount   Decimal             @default(0) @map("current_amount") @db.Decimal(15, 2)
  startDate       DateTime?           @map("start_date") @db.Date
  endDate         DateTime?           @map("end_date") @db.Date
  status          ProjectStatus       @default(ACTIVE)
  projectImageUrl String?             @map("project_image_url") @db.VarChar(500)
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_date")

  // Relations
  donations       Donation[]

  @@map("donation_projects")
}

// Modèle pour les événements
model Event {
  id                String            @id @default(cuid())
  title             String            @db.VarChar(200)
  description       String?           @db.Text
  eventDate         DateTime          @map("event_date") @db.Date
  startTime         DateTime          @map("start_time") @db.Time
  endTime           DateTime?         @map("end_time") @db.Time
  eventType         EventType         @map("event_type")
  location          String?           @db.VarChar(200)
  maxAttendees      Int?              @map("max_attendees")
  currentAttendees  Int               @default(0) @map("current_attendees")
  isRecurring       Boolean           @default(false) @map("is_recurring")
  recurringPattern  String?           @map("recurring_pattern") @db.VarChar(100)
  status            EventStatus       @default(SCHEDULED)
  createdBy         String            @map("created_by")
  eventImageUrl     String?           @map("event_image_url") @db.VarChar(500)
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  // Relations
  creator           User              @relation("EventCreator", fields: [createdBy], references: [id])
  attendances       EventAttendance[]
  sermons           Sermon[]

  @@map("events")
}

// Modèle pour les sermons
model Sermon {
  id              String            @id @default(cuid())
  title           String            @db.VarChar(200)
  pastorId        String            @map("pastor_id")
  eventId         String?           @map("event_id")
  sermonDate      DateTime          @map("sermon_date") @db.Date
  sermonType      SermonType        @map("sermon_type")
  durationMinutes Int?              @map("duration_minutes")
  audioUrl        String?           @map("audio_url") @db.VarChar(500)
  videoUrl        String?           @map("video_url") @db.VarChar(500)
  thumbnailUrl    String?           @map("thumbnail_url") @db.VarChar(500)
  description     String?           @db.Text
  bibleVerses     String?           @map("bible_verses") @db.Text
  sermonNotes     String?           @map("sermon_notes") @db.Text
  isPublished     Boolean           @default(false) @map("is_published")
  viewCount       Int               @default(0) @map("view_count")
  downloadCount   Int               @default(0) @map("download_count")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  // Relations
  pastor          User              @relation(fields: [pastorId], references: [id])
  event           Event?            @relation(fields: [eventId], references: [id])

  @@map("sermons")
}

// Modèle pour les rendez-vous
model Appointment {
  id              String            @id @default(cuid())
  userId          String            @map("user_id")
  pastorId        String            @map("pastor_id")
  appointmentDate DateTime          @map("appointment_date") @db.Date
  startTime       DateTime          @map("start_time") @db.Time
  endTime         DateTime          @map("end_time") @db.Time
  reason          String            @db.Text
  status          AppointmentStatus @default(SCHEDULED)
  notes           String?           @db.Text
  location        String?           @db.VarChar(200)
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  // Relations
  user            User              @relation("UserAppointments", fields: [userId], references: [id], onDelete: Cascade)
  pastor          User              @relation("PastorAppointments", fields: [pastorId], references: [id])

  @@map("appointments")
}

// Modèle pour les demandes de prière
model Prayer {
  id            String         @id @default(cuid())
  userId        String         @map("user_id")
  title         String         @db.VarChar(200)
  content       String         @db.Text
  category      PrayerCategory @default(GENERAL)
  isPublic      Boolean        @default(true) @map("is_public")
  isAnswered    Boolean        @default(false) @map("is_answered")
  answeredDate  DateTime?      @map("answered_date") @db.Date
  prayerCount   Int            @default(0) @map("prayer_count")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  // Relations
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  supporters    PrayerSupport[]

  @@map("prayers")
}

// Modèle pour le support aux prières
model PrayerSupport {
  id        String   @id @default(cuid())
  prayerId  String   @map("prayer_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  prayer    Prayer   @relation(fields: [prayerId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([prayerId, userId])
  @@map("prayer_supports")
}

// Modèle pour les témoignages
model Testimony {
  id            String             @id @default(cuid())
  userId        String             @map("user_id")
  title         String             @db.VarChar(200)
  content       String             @db.Text
  isApproved    Boolean            @default(false) @map("is_approved")
  approvedBy    String?            @map("approved_by")
  approvedAt    DateTime?          @map("approved_at")
  isPublished   Boolean            @default(false) @map("is_published")
  publishedAt   DateTime?          @map("published_at")
  category      TestimonyCategory  @default(HEALING)
  imageUrl      String?            @map("image_url") @db.VarChar(500)
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")

  // Relations
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("testimonies")
}

// Modèle pour les messages du chat
model Message {
  id           String    @id @default(cuid())
  channelId    String    @map("channel_id")
  senderId     String    @map("sender_id")
  content      String    @db.Text
  isEdited     Boolean   @default(false) @map("is_edited")
  messageType  MessageType @default(TEXT) @map("message_type")
  fileUrl      String?   @map("file_url") @db.VarChar(500)
  fileName     String?   @map("file_name") @db.VarChar(255)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  // Relations
  channel      Channel   @relation(fields: [channelId], references: [id], onDelete: Cascade)
  sender       User      @relation(fields: [senderId], references: [id], onDelete: Cascade)
  reactions    MessageReaction[]

  @@map("messages")
}

// Autres modèles...
model EventAttendance {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  eventId        String   @map("event_id")
  attendanceDate DateTime @map("attendance_date") @db.Date
  checkInTime    DateTime? @map("check_in_time") @db.Timestamptz(3)
  checkOutTime   DateTime? @map("check_out_time") @db.Timestamptz(3)
  status         AttendanceStatus @default(PRESENT)
  notes          String?  @db.Text
  createdAt      DateTime @default(now()) @map("created_at")

  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event          Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId, attendanceDate])
  @@map("event_attendances")
}

model Notification {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  title          String   @db.VarChar(200)
  message        String   @db.Text
  type           NotificationType @default(GENERAL)
  isRead         Boolean  @default(false) @map("is_read")
  actionUrl      String?  @map("action_url") @db.VarChar(500)
  createdAt      DateTime @default(now()) @map("created_at")

  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model FaceRecognitionData {
  id         String  @id @default(cuid())
  userId     String  @map("user_id")
  faceData   String  @map("face_data") @db.Text
  confidence Decimal @db.Decimal(5, 4)
  createdAt  DateTime @default(now()) @map("created_at")

  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("face_recognition_data")
}

model Channel {
  id          String    @id @default(cuid())
  name        String    @db.VarChar(100)
  description String?   @db.Text
  type        ChannelType @default(PUBLIC)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  messages    Message[]
  members     ChannelMember[]

  @@map("channels")
}

model ChannelMember {
  id        String   @id @default(cuid())
  channelId String   @map("channel_id")
  userId    String   @map("user_id")
  role      ChannelRole @default(MEMBER)
  joinedAt  DateTime @default(now()) @map("joined_at")

  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@map("channel_members")
}

model MessageReaction {
  id        String   @id @default(cuid())
  messageId String   @map("message_id")
  userId    String   @map("user_id")
  emoji     String   @db.VarChar(10)
  createdAt DateTime @default(now()) @map("created_at")

  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@map("message_reactions")
}

// Enums pour les types de données
enum DonationType {
  OFFERING
  TITHE
  FREEWILL
  PROJECT
  BUILDING
  OTHER
}

enum PaymentMethod {
  CASH
  CARD
  MOBILE_MONEY
  BANK_TRANSFER
  CHECK
}

enum DonationStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
  PAUSED
  CANCELLED
}

enum EventType {
  WORSHIP_SERVICE
  PRAYER_MEETING
  BIBLE_STUDY
  YOUTH_MEETING
  CONFERENCE
  BAPTISM
  WEDDING
  FUNERAL
  OUTREACH
  OTHER
}

enum EventStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum SermonType {
  AUDIO
  VIDEO
  TEXT
  LIVE_STREAM
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum PrayerCategory {
  HEALING
  FAMILY
  FINANCES
  CAREER
  RELATIONSHIPS
  SPIRITUAL_GROWTH
  GENERAL
  URGENT
}

enum TestimonyCategory {
  HEALING
  SALVATION
  BREAKTHROUGH
  ANSWERED_PRAYER
  SPIRITUAL_GROWTH
  FAMILY_RESTORATION
  FINANCIAL_BLESSING
  OTHER
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum NotificationType {
  GENERAL
  EVENT_REMINDER
  APPOINTMENT_REMINDER
  PRAYER_REQUEST
  TESTIMONY_APPROVED
  DONATION_RECEIPT
  SYSTEM_UPDATE
}

enum ChannelType {
  PUBLIC
  PRIVATE
  ANNOUNCEMENT
  PRAYER
}

enum ChannelRole {
  MEMBER
  MODERATOR
  ADMIN
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  VOICE
}